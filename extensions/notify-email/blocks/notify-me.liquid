{% if product.selected_or_first_available_variant.available == false %}
<style>
.product-form__buttons, .shopify-payment-button { display:none !important; }
#bis-btn { width:100%; padding:15px; background:black; color:white; cursor:pointer; }
#bis-modal { margin-top:10px; }
</style>

<button id="bis-btn">Notify me when available</button>

<div id="bis-modal" style="display:none;">
  <input type="email" id="bis-email" placeholder="Enter your email" style="width:100%;padding:10px;margin-bottom:10px;">
  <button id="bis-submit" style="width:100%;padding:10px;">Submit</button>
</div>

<script>
document.getElementById("bis-btn").onclick = () => {
  document.getElementById("bis-modal").style.display = "block";
};

document.getElementById("bis-submit").onclick = async () => {
  const email = document.getElementById("bis-email").value;
  const variantId = "{{ product.selected_or_first_available_variant.id }}";

  if(!email){
    alert("Please enter email");
    return;
  }

  const res = await fetch("/apps/notify-out-stock/proxy/subscribe", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      email,
      variantId,
      shop: "{{ shop.permanent_domain }}"
    })
  });

  const data = await res.json();

  if(data.success){
    alert("You will be notified when product is back in stock!");
  }else{
    alert("Something went wrong!");
  }
};
</script>
{% endif %}

{% schema %}
{
  "name": "Notify Me",
  "target": "section"
}
{% endschema %}
